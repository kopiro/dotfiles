#!/bin/bash

for i in $(find . -type d -maxdepth 1 -mindepth 1); do 
    echo "Looking in $i..."
    if [ -d "$i/.git" ]; then
        echo "Found repository in $i, init backup..."
        pushd $i > /dev/null
        zip_name="$i-$(date +'%y%m%d').zip"
        zip_path="/opt/backups/$zip_name"
        echo "ZIP path: $zip_path"
        if [ ! -f "$zip_path" ]; then
            echo "Backing up..."
            git archive --format=zip --output="$zip_path" master
        else
            echo "ZIP $zip_path already exists, ignoring!"
        fi
        popd > /dev/null
    fi
done