# ZSH things
export ZSH=$HOME/.oh-my-zsh
ZSH_THEME=robbyrussell
plugins=(
    gitfast 
    osx 
    jsontools 
    last-working-dir 
    npm 
    zsh-syntax-highlighting 
    colored-man 
    colorize 
    common-aliases 
    brew 
    copyfile 
    docker 
    encode64
    sudo
    z
    alias-tips
    vscode
)

alias dotenv='export $(cat .env | xargs)'

alias dc='docker-compose'
alias dcu='docker-compose up --build'

alias d-kill='docker ps -q | xargs docker kill'
alias d-prune='docker system prune --all --force'
alias d-erase='docker stop $(docker container ls -a -q); docker system prune -a -f --volumes'

alias socat-x11='open -a XQuartz && socat TCP-LISTEN:6000,reuseaddr,fork UNIX-CLIENT:\"$DISPLAY\"'
alias chrome="/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome"
alias chrome-debug="/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome --remote-debugging-port=9222"

gam() {
   git add -A && 
   git commit --amend && 
   git push -f
}

got() {
   git add -A &&
   git commit -m "$1"
}

gush() {
	git add -A &&
	git commit -m "$1" &&
	git push
}

neftojpg() {
	# Find all NEF in current directory and convert into JPG using all processors
 	mkdir -p ./JPG
 	find . -name "*.NEF" -print0 | xargs -0 -P $(sysctl -n hw.ncpu) -I file sips -s format jpeg file --out ./JPG/file.jpg
}

npmver() {
	# Do a npm version $1 and publish over NPM and GIT
   	npm version "$1" &&
   	npm publish &&
   	git push &&
   	git push --tags
}

tor-enable-proxy() {
	INTERFACE=$1
	if [ -z $INTERFACE ]; then
		INTERFACE="Wi-Fi"
	fi

	# Ask for the administrator password upfront
	sudo -v

	# Keep-alive: update existing `sudo` time stamp until finished
	while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &

	# trap ctrl-c and call disable_proxy()
	function disable_proxy() {
		sudo networksetup -setsocksfirewallproxystate $INTERFACE off
		echo "$(tput setaf 64)" #green
		echo "SOCKS proxy disabled."
		echo "$(tput sgr0)" # color reset
	}
	trap disable_proxy INT

	# Let's roll
	sudo networksetup -setsocksfirewallproxy $INTERFACE 127.0.0.1 9050 off
	sudo networksetup -setsocksfirewallproxystate $INTERFACE on

	echo "$(tput setaf 64)" # green
	echo "SOCKS proxy 127.0.0.1:9050 enabled."
	echo "$(tput setaf 136)" # orange
	echo "Starting Tor..."
	echo "$(tput sgr0)" # color reset

	tor
}

backup-repos() {
	for i in $(find . -type d -maxdepth 1 -mindepth 1); do 
		echo "Looking in $i..."
		if [ -d "$i/.git" ]; then
			echo "Found repository in $i, init backup..."
			pushd $i > /dev/null
			zip_name="$i-$(date +'%y%m%d').zip"
			zip_path="/opt/backups/$zip_name"
			echo "ZIP path: $zip_path"
			if [ ! -f "$zip_path" ]; then
				echo "Backing up..."
				git archive --format=zip --output="$zip_path" master
			else
				echo "ZIP $zip_path already exists, ignoring!"
			fi
			popd > /dev/null
		fi
	done
}

# Variables
export CC="gcc"
export CXX="g++"
export EDITOR=nano
export LC_ALL=en_US.UTF-8
export LC_CTYPE=en_US.UTF-8
export LANGUAGE=en
export LANG=en
export NODE_PATH=/usr/local/lib/node_modules
export HOMEBREW_CASK_OPTS="--appdir=/Applications"
export TITANIUM_SDK=~/Library/Application\ Support/Titanium/mobilesdk/osx
export GOOGLE_APIS=/opt/android/add-ons/addon-google_apis-google-23
export JAVA_HOME=`/usr/libexec/java_home`
export BREW_PATH=`brew --prefix`
export ANDROID_SDK=~/Library/Android/sdk
export ANDROID_NDK=~/Library/Android/sdk/ndk-bundle
export NDK_CCACHE=/usr/local/bin/ccache
export NUM_CPUS=8
export NODE_ENV=development
export USE_SDK_WRAPPER=1

export EN0_IP=$(ifconfig en0 | grep "inet " | cut -d " " -f 2)

# Path
PATH=''
PATH=$PATH:~/.composer/vendor/bin
PATH=$PATH:~/Library/Android/sdk/tools
PATH=$PATH:~/Library/Android/sdk/build-tools
PATH=$PATH:~/Library/Android/sdk/platform-tools
PATH=$PATH:~/Library/Android/sdk/tools/bin
PATH=$PATH:/opt/bin
PATH=$PATH:/usr/local/bin
PATH=$PATH:/usr/local/sbin
PATH=$PATH:/usr/bin
PATH=$PATH:/usr/sbin
PATH=$PATH:/bin
PATH=$PATH:/sbin
export PATH

# iTerm shell integration
test -e ~/.iterm2_shell_integration.zsh && source ~/.iterm2_shell_integration.zsh

if [[ $(date +"%d%m") =~ ^2[4-6]12$ ]]; then   
  echo "Merry Christmas ðŸŽ…"  
fi

if [ $(date +"%A") = "Sunday" ]; then
	echo "Oh... com'on ðŸ˜°, it's Sunday, go back to sleep! ðŸ›Œ"
fi

export NVM_DIR="$HOME/.nvm"
[ -s "/usr/local/opt/nvm/nvm.sh" ] && . "/usr/local/opt/nvm/nvm.sh"  # This loads nvm
[ -s "/usr/local/opt/nvm/etc/bash_completion" ] && . "/usr/local/opt/nvm/etc/bash_completion"
